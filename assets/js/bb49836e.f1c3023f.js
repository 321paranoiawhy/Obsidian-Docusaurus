"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8346],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),i=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=i(e.components);return a.createElement(p.Provider,{value:n},e.children)},_="mdxType",E={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),_=i(t),u=r,m=_["".concat(p,".").concat(u)]||_[u]||E[u]||o;return t?a.createElement(m,l(l({ref:n},c),{},{components:t})):a.createElement(m,l({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=u;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s[_]="string"==typeof e?e:r,l[1]=s;for(var i=2;i<o;i++)l[i]=t[i];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},3537:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>E,frontMatter:()=>o,metadata:()=>s,toc:()=>i});var a=t(7462),r=(t(7294),t(3905));const o={},l="Local",s={unversionedId:"Docker/n8n",id:"Docker/n8n",title:"Local",description:"Dockerfile",source:"@site/docs/Docker/n8n.md",sourceDirName:"Docker",slug:"/Docker/n8n",permalink:"/Obsidian-Docusaurus/docs/Docker/n8n",draft:!1,editUrl:"https://github.com/321paranoiawhy/Obsidian-Docusaurus/edit/dev/docs/Docker/n8n.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u6fc0\u6d3b",permalink:"/Obsidian-Docusaurus/docs/Docker/Tools/Navicat"},next:{title:"influxdb",permalink:"/Obsidian-Docusaurus/docs/Docker/\u6570\u636e\u5e93\u7ba1\u7406\u9875\u9762"}},p={},i=[{value:"Dockerfile",id:"dockerfile",level:2},{value:"Dockerfile \u914d\u7f6e",id:"dockerfile-\u914d\u7f6e",level:3},{value:"npm",id:"npm",level:2},{value:"npm",id:"npm-1",level:2},{value:"Docker",id:"docker",level:2}],c={toc:i},_="wrapper";function E(e){let{components:n,...t}=e;return(0,r.kt)(_,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"local"},"Local"),(0,r.kt)("h2",{id:"dockerfile"},"Dockerfile"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t n8n .\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run --name n8n -p 5678:5678 -p 443:443 -d n8n\n")),(0,r.kt)("h3",{id:"dockerfile-\u914d\u7f6e"},"Dockerfile \u914d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},"# packages/cli/config/index.ts\nENV DB_MYSQLDB_HOST=10.10.21.86\nENV DB_MYSQLDB_PORT=3307\nENV DB_MYSQLDB_USER=root\nENV DB_MYSQLDB_PASSWORD=123456\nENV QUEUE_BULL_REDIS_HOST=10.10.21.86\nENV QUEUE_BULL_REDIS_PORT=6379\nENV QUEUE_BULL_REDIS_PASSWORD=''\n\n# packages/nodes-base/config/index.ts\nENV STORAGE_REDIS_HOST=10.10.21.86\nENV STORAGE_REDIS_PORT=6379\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"MySQL")," \u4e2d\u987b\u6709 ",(0,r.kt)("inlineCode",{parentName:"p"},"n8n")," \u6570\u636e\u8868\u3002")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"packages/nodes-base/config/index.ts")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"STORAGE_REDIS_HOST: process.env.STORAGE_REDIS_HOST ?? '10.10.21.86',\nSTORAGE_REDIS_PORT: process.env.STORAGE_REDIS_PORT ?? '6379',\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"\u5173\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"process.env")," :"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://nodejs.org/dist/latest-v8.x/docs/api/process.html#process_process_env"},"process.env - node.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://juejin.cn/post/6915214622601674760"},"\u6765\uff0c\u8ba9\u6211\u4eec\u4e00\u8d77\u6765\u76d8\u76d8 Nodejs \u73af\u5883\u53d8\u91cf (process.env)")))),(0,r.kt)("h2",{id:"npm"},"npm"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install -g lerna\nnpm install --production --loglevel notice\nnode loadEnv.js\nlerna bootstrap --hoist\nnpm run build\nnpm run start\n")),(0,r.kt)("admonition",{title:"loadEnv.js",type:"important"},(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"require('dotenv').config();\nconsole.log(process.env);\n"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"[!success]"," lerna bootstrap --hoist\nlerna success Bootstrapped 6 packages")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"[!success]",' npm run build\nlerna success exec Executed command in 6 packages: "npm run build"')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"[!error]"," npm run start\nInitializing n8n process\ninvalid vhost [].\n\xbb   Error: There was an error: Cannot read property 'on' of undefined")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"[!error]","\nThere was an error initializing DB: \"Access denied for user 'root'@'localhost' (using password: NO)\"")),(0,r.kt)("p",null,"\u67e5\u8be2 ",(0,r.kt)("inlineCode",{parentName:"p"},"MySQL")," \u7528\u6237:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"select Host, User from mysql.user;\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"powershell")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$env:DB_MYSQLDB_DATABASE="n8n";$env:DB_MYSQLDB_HOST="localhost";$env:DB_MYSQLDB_PORT="3307";$env:DB_MYSQLDB_USER="root";$env:DB_MYSQLDB_PASSWORD="123456";$env:DB_TYPE="mysqldb";$env:PORTAL_API_BASE="http://api-portal:8080";$env:DEVICE_API_BASE="http://api-device:8080";$env:DEVICE_DATA_API_BASE="http://api-data:8080";$env:VIRTUAL_CONTROLLER_API_BASE="http://api-virtual-controller:5000";$env:MQTT_PROTOCOL="mqtt";$env:MQTT_HOST="localhost";$env:MQTT_PORT="1883";$env:MQTT_CLEAN_SESSION="false";$env:RABBITMQ_URLS="amqp://localhost:5672/";$env:RABBITMQ_MESSAGE_QUEUE_VHOST="n8n-mq";$env:RABBITMQ_USERNAME="guest";$env:RABBITMQ_PASSWORD="guest";$env:RABBITMQ_TOPIC_EXCHANGENAME="amq.topic";$env:RABBITMQ_TRIGGER_QUEUE_TTL="300000";$env:RABBITMQ_QUEUENAME_WEBSOCKET_DATA="cereb.websocket-data";$env:SHADOW_WEBSOCKET_TOPIC="/topic/shadow_websocket";$env:STORAGE_REDIS_HOST="localhost";$env:STORAGE_REDIS_PORT="6379";$env:STORAGE_REDIS_DB="1";$env:REDIS_CACHE_DEVICE_TIME_SEC="600";$env:QUEUE_BULL_REDIS_HOST="localhost";$env:QUEUE_BULL_REDIS_PORT="6379";$env:QUEUE_BULL_REDIS_DB="1";$env:EXECUTIONS_PROCESS="own";$env:EXECUTIONS_MODE="regular";$env:N8N_SKIP_WEBHOOK_DEREGISTRATION_SHUTDOWN="false";$env:WEBHOOK_DOMAIN="localhost:5678/";$env:WORKFLOW_DOMAIN="localhost:5678/";$env:WEBHOOK_URL="http://localhost:5678/";$env:CUSTOM_BASE_URL="http://localhost:5678/";$env:N8N_DISABLE_PRODUCTION_MAIN_PROCESS="true";$env:N8N_BASIC_AUTH_ACTIVE="false";$env:N8N_HOST="localhost";$env:N8N_PORT="5678";$env:N8N_PROTOCOL="http";$env:N8N_CEREB_JWT_SECRET="cerebsecret";$env:N8N_ENCRYPTION_KEY="itsn8nsecret";$env:VUE_APP_URL_BASE_API="http://localhost:5678/";$env:NODE_ENV="production";$env:EXECUTIONS_DATA_PRUNE="true";$env:EXECUTIONS_DATA_MAX_AGE="168";$env:EXECUTIONS_TIMEOUT_MAX="600"\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$env:DB_MYSQLDB_DATABASE="n8n";$env:DB_MYSQLDB_HOST="localhost";$env:DB_MYSQLDB_PORT="3307";$env:DB_MYSQLDB_USER="root";$env:DB_MYSQLDB_PASSWORD="123456";$env:DB_TYPE="mysqldb";$env:PORTAL_API_BASE="http://api-portal:8080";$env:DEVICE_API_BASE="http://api-device:8080";$env:DEVICE_DATA_API_BASE="http://api-data:8080";$env:VIRTUAL_CONTROLLER_API_BASE="http://api-virtual-controller:5000";$env:MQTT_PROTOCOL="mqtt";$env:MQTT_HOST="localhost";$env:MQTT_PORT="1883";$env:MQTT_CLEAN_SESSION="false";$env:RABBITMQ_URLS="amqp://localhost:5672/";$env:RABBITMQ_MESSAGE_QUEUE_VHOST="n8n-mq";$env:RABBITMQ_USERNAME="guest";$env:RABBITMQ_PASSWORD="guest";$env:RABBITMQ_TOPIC_EXCHANGENAME="amq.topic";$env:RABBITMQ_TRIGGER_QUEUE_TTL="300000";$env:RABBITMQ_QUEUENAME_WEBSOCKET_DATA="cereb.websocket-data";$env:SHADOW_WEBSOCKET_TOPIC="/topic/shadow_websocket";$env:STORAGE_REDIS_HOST="localhost";$env:STORAGE_REDIS_PORT="6379";$env:STORAGE_REDIS_DB="1";$env:REDIS_CACHE_DEVICE_TIME_SEC="600"\n')),(0,r.kt)("p",null,"\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"powershell")," \u4e2d\u8f93\u5165 ",(0,r.kt)("inlineCode",{parentName:"p"},"env.ps1")," \u540e\u62a5\u9519\u5982\u4e0b:"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"[!error]","\nSuggestion ","[3,General]",': \u627e\u4e0d\u5230\u547d\u4ee4 env.ps1\uff0c\u4f46\u5b83\u786e\u5b9e\u5b58\u5728\u4e8e\u5f53\u524d\u4f4d\u7f6e\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cWindows PowerShell \u4e0d\u4f1a\u4ece\u5f53\u524d\u4f4d\u7f6e\u52a0\u8f7d\u547d\u4ee4\u3002\u5982\u679c\u4fe1\u4efb\u6b64\u547d\u4ee4\uff0c\u8bf7\u6539\u4e3a\u952e\u5165\u201c.\\env.ps1\u201d\u3002\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 "get-help about_Command_Precedence"\u3002')),(0,r.kt)("p",null,"\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"powershell")," \u4e2d\u8f93\u5165 ",(0,r.kt)("inlineCode",{parentName:"p"},".\\env.ps1")," \u5373\u53ef:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},".\\env.ps1\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.n8n.io/hosting/scaling/execution-modes-processes/"},"Execution modes and processes - n8n Documentation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"EXECUTIONS_PROCESS")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"own (default)")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"li"},"main")," "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"EXECUTIONS_MODE")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"regular (default)")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"li"},"queue"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"cmd")," :"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"[!tip]","- /healthz ","[GET]"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"        // ----------------------------------------\n        // Healthcheck\n        // ----------------------------------------\n\n\n        // Does very basic health check\n        this.app.get('/healthz', async (req: express.Request, res: express.Response) => {\n\n            // const connectionManager = getConnectionManager();\n\n            // if (connectionManager.connections.length === 0) {\n            //  const error = new ResponseHelper.ResponseError('No Database connection found!', undefined, 503);\n            //  return ResponseHelper.sendErrorResponse(res, error);\n            // }\n\n            // if (connectionManager.connections[0].isConnected === false) {\n            //  // Connection is not active\n            //  const error = new ResponseHelper.ResponseError('Database connection not active!', undefined, 503);\n            //  return ResponseHelper.sendErrorResponse(res, error);\n            // }\n\n            // Everything fine\n            const responseData = {\n                status: 'ok',\n            };\n\n            ResponseHelper.sendSuccessResponse(res, responseData, true, 200);\n        });\n"))),(0,r.kt)("h1",{id:"official"},"Official"),(0,r.kt)("h2",{id:"npm-1"},"npm"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.n8n.io/hosting/installation/npm/"},"npm"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx n8n\n")),(0,r.kt)("p",null,"\u672c\u5730\u6253\u5f00\u94fe\u63a5 ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:5678/")," \u5373\u53ef\u3002"),(0,r.kt)("h2",{id:"docker"},"Docker"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.n8n.io/hosting/installation/docker/"},"Docker Installation"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -it --rm --name n8n -p 5678:5678 -v ~/.n8n:/home/node/.n8n   n8nio/n8n\n")),(0,r.kt)("h1",{id:"\u672c\u5730\u5f00\u53d1\u8c03\u8bd5"},"\u672c\u5730\u5f00\u53d1\u8c03\u8bd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install -g lerna\nnpm install --production --loglevel notice\n.\\env.ps1\nlerna bootstrap --hoist\nnpm run build\nnpm run start\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$env:DB_MYSQLDB_DATABASE="n8n"\n$env:DB_MYSQLDB_HOST="localhost"\n$env:DB_MYSQLDB_PORT="3307"\n$env:DB_MYSQLDB_USER="root"\n$env:DB_MYSQLDB_PASSWORD="123456"\n$env:DB_TYPE="mysqldb"\n$env:PORTAL_API_BASE="http://api-portal:8080"\n$env:DEVICE_API_BASE="http://api-device:8080"\n$env:DEVICE_DATA_API_BASE="http://api-data:8080"\n$env:VIRTUAL_CONTROLLER_API_BASE="http://api-virtual-controller:5000"\n$env:MQTT_PROTOCOL="mqtt"\n$env:MQTT_HOST="localhost"\n$env:MQTT_PORT="1883"\n$env:MQTT_CLEAN_SESSION="false"\n$env:RABBITMQ_URLS="amqp://localhost:5672/"\n$env:RABBITMQ_MESSAGE_QUEUE_VHOST="n8n-mq"\n$env:RABBITMQ_USERNAME="guest"\n$env:RABBITMQ_PASSWORD="guest"\n$env:RABBITMQ_TOPIC_EXCHANGENAME="amq.topic"\n$env:RABBITMQ_TRIGGER_QUEUE_TTL="300000"\n$env:RABBITMQ_QUEUENAME_WEBSOCKET_DATA="cereb.websocket-data"\n$env:SHADOW_WEBSOCKET_TOPIC="/topic/shadow_websocket"\n$env:STORAGE_REDIS_HOST="localhost"\n$env:STORAGE_REDIS_PORT="6379"\n$env:STORAGE_REDIS_DB="1"\n$env:REDIS_CACHE_DEVICE_TIME_SEC="600"\n'))),(0,r.kt)("p",null,"\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"win + r")," \u540e\u8f93\u5165 ",(0,r.kt)("inlineCode",{parentName:"li"},"sysdm.cpl")," \u9009\u62e9",(0,r.kt)("strong",{parentName:"li"},"\u9ad8\u7ea7\u9009\u9879\u5361")," -> ",(0,r.kt)("strong",{parentName:"li"},"\u73af\u5883\u53d8\u91cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"win + s")," \u540e\u8f93\u5165",(0,r.kt)("strong",{parentName:"li"},"\u73af\u5883\u53d8\u91cf")," \u9009\u62e9",(0,r.kt)("strong",{parentName:"li"},"\u7f16\u8f91\u7cfb\u7edf\u73af\u5883\u53d8\u91cf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cmd")," \u4e0b ",(0,r.kt)("inlineCode",{parentName:"li"},"set test='test'")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"powershell")," \u4e0b ",(0,r.kt)("inlineCode",{parentName:"li"},"$env:test='test'")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"bash")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"li"},"zsh")," \u4e0b ",(0,r.kt)("inlineCode",{parentName:"li"},"export test=test"))),(0,r.kt)("p",null,"\u67e5\u770b ",(0,r.kt)("inlineCode",{parentName:"p"},"bash")," \u8fd8\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"zsh")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"echo $0\necho $SHELL\n")))}E.isMDXComponent=!0}}]);